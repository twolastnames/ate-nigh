/*****************************************************
* DO NOT MODIFY THIS!!!
* Edit the schemas.json file at the base of the project
* then run "npm run dbschema" to regenerate this
*****************************************************/

//import type { NextApiRequest, NextApiResponse } from "next";
import { NextRequest, NextResponse } from "next/server";
import { substitutePipelineParameters } from "<%= backPath %>helpers"

/* eslint-disable @typescript-eslint/no-unused-vars */
import {
<% for(const type of types) { %><%= type %>Type,<% } %>
} from "<%= backPath %>../../types/db"

import {
<% for(const model of Object.keys(schemas.collections)) { %><%= model %>,<% } %>
} from "<%= backPath %>../../util/db"
/* eslint-enable @typescript-eslint/no-unused-vars */

<%   if(aggregation) { %>
// eslint-disable-next-line @typescript-eslint/no-unused-vars
export async function GET(request: NextRequest) {
  try {
    return NextResponse.json(await <%= aggregation.model %>.aggregate(substitutePipelineParameters(
      request,
      <%- JSON.stringify(aggregation.pipeline) %>
    )))
  } catch(e : any) {
    return NextResponse.json({error: e.message}, {status: 400})
  }
}
<%   } %>

<%   if(collection) { %>
// eslint-disable-next-line @typescript-eslint/no-unused-vars
export async function POST(request: NextRequest) {
  const model = new <%= path %>(await request.json())
  model.save()
}
<%   } %>
